{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет - Better Together</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}">
</head>
<body>
    <header>
        <div class="logo">
            <img src="{% static 'logo.png' %}" alt="Logo">
            <span>Better Together</span>
        </div>
        <nav>
            <ul class="nav-links">
                <li><a href="{% url 'index' %}">Главная</a></li>
                <li><a href="{% url 'reports' %}">Созданные заявки</a></li>
                <li><a href="{% url 'submit_request' %}">Подать заявку</a></li>
                {% if user.is_authenticated %}
                    <form action="{% url 'logout' %}" method="post" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Выйти</button>
                    </form>
                    <a href="{% url 'profile' %}">Личный кабинет</a>
                {% else %}
                    <a href="{% url 'login' %}">Вход</a>
                    <a href="{% url 'register' %}">Регистрация</a>
                {% endif %}
            </ul>
        </nav>
    </header>
    
    <main>
        <section class="profile-container">
            <h2>Личный кабинет</h2>
            <div class="profile-info">
                <p><strong>Логин:</strong> {{ user.username }}</p>
                <p><strong>ФИО:</strong> {{ user.get_full_name }}</p>
                <p><strong>Email:</strong> {{ user.email }}</p>
                <form action="{% url 'logout' %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="logout-button">Выход</button>
                </form>
            </div>
        </section>
        
        <section class="requests-container">
            <h3>Созданные заявки</h3>
            {% if user_requests %}
                <table>
                    <thead>
                        <tr>
                            <th>Временная метка</th>
                            <th>Название</th>
                            <th>Категория заявки</th>
                            <th>Фотография</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for request in user_requests %}
                        <tr>
                            <td>{{ request.created_at|date:"d.m.Y H:i" }}</td>
                            <td>{{ request.title }}</td>
                            <td>{{ request.category }}</td>
                            <td>{{ request.status }}</td>
                            <td>
                                {% if request.image %}
                                    <img src="{{ request.image.url }}" alt="Фото" width="100">
                                {% else %}
                                    Нет фото
                                {% endif %}
                            </td>
                            {% if user.is_staff %}  <!-- Админ видит кнопки управления -->
                            <td>
                                <form action="{% url 'update_request_status' request.id %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit">Изменить статус</button>
                                </form>
                                <form action="{% url 'delete_request' request.id %}" method="post" onsubmit="return confirm('Вы уверены?');">
                                    {% csrf_token %}
                                    <button type="submit" class="delete-btn">Удалить</button>
                                </form>
                            </td>
                            {% endif %}
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6">Заявок пока нет.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>У вас пока нет заявок.</p>
            {% endif %}
        </section>
    </main>
    
    <footer>
        <p>Политика конфиденциальности</p>
    </footer>
</body>
</html>